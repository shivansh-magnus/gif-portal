{"ast":null,"code":"import _slicedToArray from \"/Users/shivanshdwivedi/Desktop/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _asyncToGenerator from \"/Users/shivanshdwivedi/Desktop/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/Users/shivanshdwivedi/Desktop/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/shivanshdwivedi/Desktop/gif-portal-starter/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _regeneratorRuntime from \"/Users/shivanshdwivedi/Desktop/gif-portal-starter/node_modules/@babel/runtime/regenerator/index.js\";\nimport { splitArgsAndCtx } from \"../context\";\nimport { EventParser } from \"../event\";\nimport { ProgramError } from \"../../error\";\n\nvar SimulateFactory = /*#__PURE__*/function () {\n  function SimulateFactory() {\n    _classCallCheck(this, SimulateFactory);\n  }\n\n  _createClass(SimulateFactory, null, [{\n    key: \"build\",\n    value: function build(idlIx, txFn, idlErrors, provider, coder, programId, idl) {\n      var simulate = /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n          var _len,\n              args,\n              _key,\n              tx,\n              _splitArgsAndCtx,\n              _splitArgsAndCtx2,\n              ctx,\n              resp,\n              translatedErr,\n              logs,\n              events,\n              parser,\n              _args = arguments;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  for (_len = _args.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n                    args[_key] = _args[_key];\n                  }\n\n                  tx = txFn.apply(void 0, args);\n                  _splitArgsAndCtx = splitArgsAndCtx(idlIx, [].concat(args)), _splitArgsAndCtx2 = _slicedToArray(_splitArgsAndCtx, 2), ctx = _splitArgsAndCtx2[1];\n                  resp = undefined;\n                  _context.prev = 4;\n                  _context.next = 7;\n                  return provider.simulate(tx, ctx.signers, ctx.options);\n\n                case 7:\n                  resp = _context.sent;\n                  _context.next = 17;\n                  break;\n\n                case 10:\n                  _context.prev = 10;\n                  _context.t0 = _context[\"catch\"](4);\n                  console.log(\"Translating error\", _context.t0);\n                  translatedErr = ProgramError.parse(_context.t0, idlErrors);\n\n                  if (!(translatedErr === null)) {\n                    _context.next = 16;\n                    break;\n                  }\n\n                  throw _context.t0;\n\n                case 16:\n                  throw translatedErr;\n\n                case 17:\n                  if (!(resp === undefined)) {\n                    _context.next = 19;\n                    break;\n                  }\n\n                  throw new Error(\"Unable to simulate transaction\");\n\n                case 19:\n                  if (!resp.value.err) {\n                    _context.next = 21;\n                    break;\n                  }\n\n                  throw new Error(\"Simulate error: \".concat(resp.value.err.toString()));\n\n                case 21:\n                  logs = resp.value.logs;\n\n                  if (logs) {\n                    _context.next = 24;\n                    break;\n                  }\n\n                  throw new Error(\"Simulated logs not found\");\n\n                case 24:\n                  events = [];\n\n                  if (idl.events) {\n                    parser = new EventParser(programId, coder);\n                    parser.parseLogs(logs, function (event) {\n                      events.push(event);\n                    });\n                  }\n\n                  return _context.abrupt(\"return\", {\n                    events: events,\n                    raw: logs\n                  });\n\n                case 27:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, null, [[4, 10]]);\n        }));\n\n        return function simulate() {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      return simulate;\n    }\n  }]);\n\n  return SimulateFactory;\n}();\n\nexport { SimulateFactory as default };","map":{"version":3,"mappings":";;;;;AAMA,SAASA,eAAT,QAAgC,YAAhC;AAEA,SAASC,WAAT,QAAmC,UAAnC;AAGA,SAASC,YAAT,QAA6B,aAA7B;;IAQqBC,e;;;;;;;WACZ,eACLC,KADK,EAELC,IAFK,EAGLC,SAHK,EAILC,QAJK,EAKLC,KALK,EAMLC,SANK,EAOLC,GAPK,EAOG;MAER,IAAMC,QAAQ;QAAA,oEAAoB;UAAA;UAAA;UAAA;UAAA;UAAA;UAAA;UAAA;UAAA;UAAA;UAAA;UAAA;UAAA;UAAA;;UAAA;YAAA;cAAA;gBAAA;kBAAA,0BAAUC,IAAV;oBAAUA,IAAV;kBAAA;;kBAC1BC,EAD0B,GACrBR,IAAI,MAAJ,SAAQO,IAAR,CADqB;kBAAA,mBAEhBZ,eAAe,CAACI,KAAD,YAAYQ,IAAZ,EAFC,2DAEvBE,GAFuB;kBAG5BC,IAH4B,GAKhBC,SALgB;kBAAA;kBAAA;kBAAA,OAOjBT,QAAS,CAACI,QAAV,CAAmBE,EAAnB,EAAuBC,GAAG,CAACG,OAA3B,EAAoCH,GAAG,CAACI,OAAxC,CAPiB;;gBAAA;kBAO9BH,IAP8B;kBAAA;kBAAA;;gBAAA;kBAAA;kBAAA;kBAS9BI,OAAO,CAACC,GAAR,CAAY,mBAAZ;kBACIC,aAV0B,GAUVnB,YAAY,CAACoB,KAAb,cAAwBhB,SAAxB,CAVU;;kBAAA,MAW1Be,aAAa,KAAK,IAXQ;oBAAA;oBAAA;kBAAA;;kBAAA;;gBAAA;kBAAA,MAcxBA,aAdwB;;gBAAA;kBAAA,MAgB5BN,IAAI,KAAKC,SAhBmB;oBAAA;oBAAA;kBAAA;;kBAAA,MAiBxB,IAAIO,KAAJ,CAAU,gCAAV,CAjBwB;;gBAAA;kBAAA,KAmB5BR,IAAI,CAACS,KAAL,CAAWC,GAnBiB;oBAAA;oBAAA;kBAAA;;kBAAA,MAoBxB,IAAIF,KAAJ,2BAA6BR,IAAI,CAACS,KAAL,CAAWC,GAAX,CAAeC,QAAf,EAA7B,EApBwB;;gBAAA;kBAsB1BC,IAtB0B,GAsBnBZ,IAAI,CAACS,KAAL,CAAWG,IAtBQ;;kBAAA,IAuB3BA,IAvB2B;oBAAA;oBAAA;kBAAA;;kBAAA,MAwBxB,IAAIJ,KAAJ,CAAU,0BAAV,CAxBwB;;gBAAA;kBA2B1BK,MA3B0B,GA2BiB,EA3BjB;;kBA4BhC,IAAIlB,GAAG,CAACkB,MAAR,EAAgB;oBACVC,MADU,GACD,IAAI5B,WAAJ,CAAgBQ,SAAhB,EAA2BD,KAA3B,CADC;oBAEdqB,MAAM,CAACC,SAAP,CAAiBH,IAAjB,EAAuB,UAACI,KAAD,EAAU;sBAC/BH,MAAM,CAACI,IAAP,CAAYD,KAAZ;oBACD,CAFD;kBAGD;;kBAjC+B,iCAkCzB;oBAAEH,MAAM,EAANA,MAAF;oBAAUK,GAAG,EAAEN;kBAAf,CAlCyB;;gBAAA;gBAAA;kBAAA;cAAA;YAAA;UAAA;QAAA,CAApB;;QAAA,gBAARhB,QAAQ;UAAA;QAAA;MAAA,GAAd;;MAqCA,OAAOA,QAAP;IACD;;;;;;SAhDkBR,e","names":["splitArgsAndCtx","EventParser","ProgramError","SimulateFactory","idlIx","txFn","idlErrors","provider","coder","programId","idl","simulate","args","tx","ctx","resp","undefined","signers","options","console","log","translatedErr","parse","Error","value","err","toString","logs","events","parser","parseLogs","event","push","raw"],"sourceRoot":"","sources":["../../../../src/program/namespace/simulate.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}